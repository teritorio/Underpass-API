<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Underpass WASM Demo</title>
</head>

<body>
  <h1>Underpass WASM</h1>

  <p>Underpass as Overpass Query converter to SQL</p>

  <p>Underpass WASM is an engin able to execute (part of) Overpass Query without the need of an Overpass-API server.
    Using an in browser WASM Overpass Query converter to SQL and a WASM DuckDB/QuackOSM data base relying on a remote
    static Parquet file produced using QuackOSM.</p>

  <h2>Demo</h2>
  <form>
    <label for="parquet">QuackOSM Parquet file URL</label></br>
    <input type="text" id="parquet" name="parquet" size="60" value="%VITE_PARQUET_URL%" /><br>

    <label for="overpass-query">Overpass Query</label></br>
    <textarea id="overpass-query" rows="10" cols="60" placeholder="Enter your Overpass query here">
[out:json][timeout:25];
(
  nwr[highway=bus_stop][name];
  nwr[public_transport=platform];
);
out center meta;
    </textarea></br>

    <button id="submit-query" type="submit">Run with Underpass</button>
  </form>

  <pre id="log"></pre>

  <script type="module">
    import { query } from './src/dev.ts';

    document.getElementById('submit-query').addEventListener('click', async (event) => {
      event.preventDefault(); // Prevent form submission

      const parquetUrl = document.getElementById('parquet').value;
      const overpassQuery = document.getElementById('overpass-query').value;

      if (!parquetUrl || !overpassQuery) {
        alert('Please provide both Parquet file URL and Overpass Query.');
        return;
      }

      const log = document.getElementById('log');
      const logger = (status) => {
        const p = document.createElement('div');
        p.textContent = status;
        log.appendChild(p);
      };

      try {
        document.getElementById('log').innerHTML = "";
        const results = await query(parquetUrl, overpassQuery, logger);
        for (const result of results) {
          logger(JSON.stringify(result));
        }
      } catch (error) {
        logger(error);
      }
    });
  </script>
</body>

</html>
